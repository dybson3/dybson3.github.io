---
layout: default
title: "Dynamic malware analysis example"
author: "Bartosz Dybski"
date: 2024-12-16
categories: concepts
tags: [Concepts, Example, Malware, Analysis]
---

# Basics of Dynamic Malware Analysis

Walkthrough for Let's Defend Room called Dynamic Malware Analysis Example #2.

Dynamic malware analysis involves executing malware in a controlled environment to observe its behavior and gather insights into its functionality. Here, I walk through a basic analysis of a sample file using several tools, answering questions related to its behavior and communications.

---
Sorry for the screens resolution :). 
## Setting Up the Analysis

To start the analysis, I launched the following tools:

- **Procmon**: To monitor file and registry activity.
- **Process Hacker**: For detailed process monitoring.
- **Fiddler**: To capture HTTP/HTTPS traffic.
- **Regshot**: For tracking registry changes.
- **Wireshark**: For network traffic analysis.

![obraz](https://github.com/user-attachments/assets/3a34bbef-094e-481d-b188-0b7c31c0d333)

Once the tools were ready, I executed the malware sample:  
**File Path**: `Desktop/Malware Samples/payment advice.exe`  
**Password**: `infected`  

![obraz](https://github.com/user-attachments/assets/65c02c66-6bc2-4b19-987e-b5b50ef566cd)

---

We can see our malware in Process Hacker:

![obraz](https://github.com/user-attachments/assets/759b5451-f296-4702-b3d6-783f067e1267)

## Observations and Questions

### 1. Identifying the Domain Name from Network Traffic

**Question**: What is the domain name of the web application that the malware requests to learn its IP address?  
**Steps**:  
- Observe the HTTP/HTTPS traffic in **Fiddler**.  
- In the **12th packet**, the requested domain name can be identified.

**Answer**: The domain name is captured in **Fiddler**.

![obraz](https://github.com/user-attachments/assets/5d9e9121-153d-4cb9-9e91-226e69aaf402)

---

### 2. Domain Name for Data Hijacking

**Question**: What is the domain name that the malware connects to for data hijacking?  
**Steps**:  
- Execute the malware in **AnyRun**, a sandbox environment.  
- Observe the connections the malware attempts to establish.  

![obraz](https://github.com/user-attachments/assets/04c31b8f-cf4e-48d0-a2ff-c651318464b7)

**Answer**: The domain name is `mail.stilltech.ro`.

---

### 3. Communication Port

**Question**: What port does the malware communicate over?  
**Steps**:  
- Look at the previous screenshot there is also port number given :D

**Answer**: The malware communicates over port **587**.

---

### 4. SMTP Authentication Username

**Question**: What is the username used by the malware to authenticate to the mail server?  
**Steps**:  
1. In **Wireshark**, filter the traffic with `SMTP` and `port 587`.

![obraz](https://github.com/user-attachments/assets/d67c9f89-43f2-409a-bfc4-28d2b2999fca)

2. Click on a relevant packet and follow the **TCP stream**.

![obraz](https://github.com/user-attachments/assets/9903041a-0d59-4d4e-baf0-8a72ee52e5f4)
   
3. Extract the encoded username and decode it using **CyberChef**.

![obraz](https://github.com/user-attachments/assets/981e5a16-b8b8-4676-861a-9acdcc62f8f3)

**Answer**: The username is `office@stilltech.ro`.

> *Note*: CyberChef initially decoded the username as `officu@stilltech.ro`, but correcting this to `office@stilltech.ro` worked.

---

### 5. SMTP Authentication Password

**Question**: What is the password that the malware uses to authenticate to the mail server?  
**Steps**:  
1. Locate the `AUTH` packet in Wireshark.  
2. Copy the encoded password from the packet.

![obraz](https://github.com/user-attachments/assets/ff295f0d-41c1-4c79-bc10-2aad263c06c8)

3. Decode it using **CyberChef**.

![obraz](https://github.com/user-attachments/assets/d84a5344-6d6e-478b-a1cb-71ac70c19436)

**Answer**: The password is `eurobit555ro`.

---

## Key Takeaways

Dynamic analysis requires attention to detail and a systematic approach. Tools like Process Hacker, Fiddler, Wireshark, and CyberChef make it easier to trace malicious activities and uncover critical details about malware behavior. Always ensure analysis is conducted in a secure, isolated environment to prevent unintended consequences.
